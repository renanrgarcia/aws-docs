# Auto Scaling Group (ASG)

- An `Auto Scaling Group (ASG)` is a collection of Amazon EC2 instances that are treated as a logical grouping for the purposes of automatic scaling and management.
- Why?
  - In real-world applications, the demand for resources can fluctuate based on various factors such as time of day, user activity, and application load.
  - In the cloud, we can dynamically adjust the number of instances in our application fleet to match the current demand.
- The goal:
  - Scale out (add more EC2 instances) during high demand to maintain performance.
  - Scale in (remove EC2 instances) during low demand to reduce costs.
  - Ensure we have the minimum and maximum number of instances running at any given time.
  - Automatically register new instances with load balancers to distribute traffic evenly.
  - Re-create instances in the event of a failure or termination.
- ASG is free, but we pay for the EC2 instances and other resources it manages.

## How it works

1. Set a minimum capacity (minimum number of instances to run at all times). Ex: 2
2. Set a maximum capacity (maximum number of instances to run). Ex: 10
3. Set a desired capacity (initial number of instances to run). Ex: 5
4. ASG will launch the desired number of instances and ensure that the number of running instances is always between the minimum and maximum capacity.

- It also works with load balancers (CLB, ALB, NLB) to distribute traffic to the instances in the ASG.
  - ELB health checks can be used to determine the health of instances in the ASG.
  - If an instance fails the health check, ASG can terminate it and launch a new instance to replace it.

## Attributes

- **Launch Template**: A template that defines the instance configuration for the instances in the ASG. Launch configuration is deprecated.
  - AMI + instance type
  - SSH Key pair
  - Security groups
  - EC2 User data
  - EBS volumes
  - IAM roles for EC2 instances
  - Network + Subnets Information
  - Load balancer information (if any)
- Minimum, Maximum, Desired capacity
- Scaling policies

## CloudWatch Alarms and Scaling Policies

- We can create CloudWatch alarms to monitor metrics such as CPU utilization, network traffic, or custom metrics.
  - Example: Create a CloudWatch alarm to monitor the average CPU utilization of the instances in the ASG.
- When the alarm is triggered (e.g., CPU utilization > 70% for 5 minutes), the scaling policy will be executed to add more instances to the ASG (scale out).
- Similarly, we can create another alarm to monitor when the CPU utilization drops below a certain threshold (e.g., CPU utilization < 30% for 5 minutes) and execute a scaling policy to remove instances from the ASG (scale in).

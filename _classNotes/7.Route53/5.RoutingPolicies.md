# Routing Policies

- Defines how Route 53 responds to DNS queries.
- Don't get confused with the word "routing" here.
  - It does NOT mean routing traffic like a load balancer.
  - DNS does not route traffic, it only responds to DNS queries.
- Route 53 supports several routing policies:
  - Simple
  - Weighted
  - Latency-based
  - Failover
  - Geolocation
  - Multivalue answer
  - Geoproximity (Traffic Flow feature only)

## Simple Routing

- Tipically, route traffic to a single resource.
- Can specify multiple values for the same record, and Route 53 will return all values in response to DNS queries.
  - If multiple values are returned, the client can choose which one to use.
- When alias is enabled, Route 53 responds with the IP address of the AWS resource (e.g., ELB, CloudFront).
  - We must choose only one AWS resource when alias is enabled.
- No health checks are associated with simple routing.

## Weighted Routing

- Control the distribution of traffic to multiple resources.
- Each resource (record) is assigned a weight (0 to 255).
- Route 53 routes traffic based on the weights assigned.
  - traffic (%) = weight of resource / sum of weights of all resources
  - E.g., if Resource A has a weight of 70 and Resource B has a weight of 30, then 70% of the traffic will be routed to Resource A and 30% to Resource B.
- DNS records must have the same name and type.
- Health checks can be associated with weighted routing.
- Use cases:
  - Load balancing between regions.
  - Testing new versions of an application (can route a small percentage of traffic to the new version).
- Assign 0 weight to a resource to temporarily remove it from service without deleting the record.
- If all resources are 0 weighted, Route 53 returns all resources with equal probability.

## Latency-based Routing

- Redirect traffic to the region that provides the lowest latency.
- Helpful when latency is a concern for users.
- Latency is determined by on traffic measurements between AWS and users.
- E.g. Germany users can be routed to US (if it has lower latency) instead of the closer Ireland region.
- Can be associated with health checks.

## Failover Routing

- Used to create an active-passive failover configuration.
- Primary resource is active, secondary resource is passive (only used if primary is unhealthy).
- Health checks are required for failover routing.
- If the primary resource is unhealthy, Route 53 routes traffic to the secondary resource.

## Geolocation Routing

- It's not based on latency, but on the actual location of the user.
- Route traffic based on the geographic location of users (continent, country, or state).
- Should create a default record to route traffic from locations not explicitly specified.
- Can be associated with health checks.
- Use cases: website location, restricting content based on geographic location, load balancing.

## Geoproximity Routing (Traffic Flow only)

- Route traffic based on the geographic location of users and resources.
- Ability to shift traffic from one resource to another by specifying a bias (positive or negative):
  - To expand (1 - 99): more traffic to the resource.
  - To shrink (-1 to -99): less traffic to the resource.
- Requires the use of Route 53 Traffic Flow.
- Resources can be:
  - AWS resources (specify the region).
  - Non-AWS resources (specify Latitude and Longitude).

## IP-based Routing

- Route traffic based on the IP address of the client.
- You provide a list of CIDRs blocks for your clients and the corresponding endpoints/locations (user-IP-to-endpoint mapping).
- Use cases: optimize performance, reduce costs, compliance requirements.
- Example: route end users from a particular ISP (internet service provider) to a specific endpoint.
- Visual example:
  - Users from ISP A (CIDR 192.0.2.0/24) are routed to Endpoint 1.
  - Users from ISP B (CIDR 203.0.113.0/24) are routed to Endpoint 2.

## Multivalue Answer Routing

- Used to return multiple values, such as IP addresses for web servers, in response to DNS queries.
- Route 53 responds to DNS queries with multiple values (up to 8) for the same record for each Multivalue query.
- Can be associated with health checks (return only healthy resources).
- It's not a replacement for a load balancer.
- Example:
  - You have 3 web servers with IP addresses 192.0.2.1, 192.0.2.2, and 192.0.2.3.
  - You create a Multivalue record with these IP addresses.
  - When a user queries the DNS for your domain, Route 53 returns all 3 IP addresses.
  - Name: www.example.com
  - Type: A

# S3 Event Notifications

- S3:ObjectCreated, S3:ObjectRemoved, S3:ObjectRestore, S3:Replication…
- Object name filtering possible (\*.jpg)
- Use case: generate thumbnails of images uploaded to S3
- Can create as many “S3 events” as desired
- S3 event notifications typically deliver events in seconds but can sometimes take a minute or longer
- You can send the event to:
  - SQS (Simple Queue Service) – decouple components of an application
  - SNS (Simple Notification Service) – send a notification (email, SMS, HTTP endpoint)
  - Lambda – serverless functions

## IAM Permissions

- **SNS**: S3 needs permission to publish to the SNS topic (SNS Resource (Access Policy))

  ```json
  {
    "Version": "2012-10-17",
    "Statement": {
      "Effect": "Allow",
      "Principal": {
        "Service": "s3.amazonaws.com"
      },
      "Action": "sns:Publish",
      "Resource": "arn:aws:sns:region:account-id:topic-name",
      "Condition": {
        "ArnLike": {
          "aws:SourceArn": "arn:aws:s3:::bucket-name"
        }
      }
    }
  }
  ```

- **SQS**: S3 needs permission to send messages to the SQS queue (SNS Resource (Access Policy))

  ```json
  {
    "Version": "2012-10-17",
    "Statement": [
      {
        "Effect": "Allow",
        "Principal": {
          "Service": "s3.amazonaws.com"
        },
        "Action": "sqs:SendMessage",
        "Resource": "arn:aws:sqs:region:account-id:queue-name",
        "Condition": {
          "ArnEquals": {
            "aws:SourceArn": "arn:aws:s3:::bucket-name"
          }
        }
      }
    ]
  }
  ```

- **Lambda**: S3 needs permission to invoke the Lambda function (Lambda Resource Policy)
  ```json
  {
    "Version": "2012-10-17",
    "Statement": {
      "Effect": "Allow",
      "Principal": {
        "Service": "s3.amazonaws.com"
      },
      "Action": "lambda:InvokeFunction",
      "Resource": "arn:aws:lambda:region:account-id:function:function-name",
      "Condition": {
        "ArnLike": {
          "aws:SourceArn": "arn:aws:s3:::bucket-name"
        }
      }
    }
  }
  ```

## Using Event Bridge

- Flow:
  - S3 Event (All events) → EventBridge (Rules) → Target (Lambda, SNS, SQS, Step Functions, etc.)
- Advanced filtering options with JSON rules (metadata, object size,
  name...)
- Multiple Destinations – ex Step Functions, Kinesis Streams / Firehose…
- EventBridge Capabilities – Archive, Replay Events, Reliable delivery

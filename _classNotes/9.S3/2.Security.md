# S3 Security

- User-Based
  - IAM Policies: which API calls should be allowed or denied for which users from IAM.
- Resource-Based
  - Bucket Policies: bucket wide rules from the S3 console - allows cross-account access. (Most common)
  - Object Access Control List (ACL): finer grain (can be disabled)
  - Bucket ACL: less common (can be disabled)
- Note: an IAM principal can access an S3 object if:
  - The user IAM permissions ALLOW it OR the resource policy ALLOWS it
  - AND neither the user IAM permissions nor the resource policy DENY it
- Encryption
  - In Transit: SSL/TLS (HTTPS)
  - At Rest:
    - SSE-S3 (AES-256): S3 managed keys (default)
    - SSE-KMS: AWS KMS managed keys (more control, audit trail)
    - SSE-C: Customer provided keys (most control, you manage everything)
    - Client-Side Encryption: encrypt data client-side before uploading

## Bucket Policies

- JSON based policy
  - Resources: buckets and objects
  - Effect: Allow or Deny
  - Actions: Set of API to allow or deny (e.g., s3:PutObject, s3:GetObject, etc.)
  - Principal: account or user to which the policy applies
  - Condition (optional): conditions for when the policy is in effect (e.g., IP address, MFA, etc.)
- Ex:

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Principal": "*",
      "Action": ["s3:GetObject"],
      "Resource": ["arn:aws:s3:::my-bucket/*"]
    }
  ]
}
```

- Use S3 bucket for policy to:
  - Grant public access to the bucket
  - Force objects to be encrypted at upload
  - Grant access to another AWS account (cross-account access)
- Some examples:
  - public access > S3 bucket (S3 bucket policy: Allow GetObject to everyone)
  - IAM user (IAM policy: Allow ListBucket, GetObject to specific bucket) > S3 bucket
  - EC2 instance (IAM role with IAM permissions: Allow ListBucket, GetObject to specific bucket) > S3 bucket
  - Cross-account access > S3 bucket (S3 bucket policy: Allow ListBucket, GetObject to specific AWS account)

## Bucket settings for Block Public Access (default for new buckets)

- Created to prevent company data leaks
- If you know your buckets should never be public, keep these settings ON
  - Set OFF only if you have a specific use case that requires public access
- Can be overridden at the account level (not recommended) if you wants to set for all buckets in the account
- Four settings:
  - Block public ACLs: ignore public ACLs on the bucket and objects
  - Block public and cross-account access if bucket has public ACLs: ignore public and cross-account ACLs on the bucket and objects
  - Block new public bucket policies: ignore any new bucket policies that allow public access
  - Block public and cross-account access if bucket has public policies: ignore any bucket policies that allow public or cross-account access

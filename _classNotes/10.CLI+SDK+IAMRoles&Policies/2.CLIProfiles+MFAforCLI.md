# AWS CLI Profiles

- AWS CLI Profiles allow you to manage multiple sets of credentials and configurations for different AWS accounts or roles.
- Profiles are defined in two main files located in the `~/.aws/` directory:
  - `credentials`: stores access keys (Access Key ID and Secret Access Key)
  - `config`: stores configuration settings (region, output format, etc.)
- Steps:
  1. Create a new profile using the AWS CLI:
     ```bash
     aws configure --profile <profile_name>
     ```
  - This command will prompt you to enter the Access Key ID, Secret Access Key, default region, and output format for the new profile.
  2. Use the profile in your AWS CLI commands by specifying the `--profile` option:
     ```bash
     aws s3 ls --profile <profile_name>
     ```
  3. You can also set the `AWS_PROFILE` environment variable to use a specific profile for all commands in your terminal session:
     ```bash
     export AWS_PROFILE=<profile_name>
     ```

# MFA with AWS CLI

- To use MFA with the CLI, you must create a temporary session
- To do so, you must run the STS GetSessionToken API call
  - AWS Security Token Service (STS) is a service that enables you to request temporary, limited-privilege credentials for AWS Identity and Access Management (IAM) users or federated users.
- `aws sts get-session-token --serial-number arn-of-the-mfa-device --tokencode code-from-token --duration-seconds 3600`
- Returns:

```json
{
  "Credentials": {
    "AccessKeyId": "ASIAxxxxxxxxxxxx",
    "SecretAccessKey": "xxxxxxxxxxxxxxxxxxxx",
    "SessionToken": "xxxxxxxxxxxxxxxxxxxx",
    "Expiration": "2022-01-01T00:00:00Z"
  }
}
```

- We can use it to create a new profile in the credentials file

```bash
aws configure --profile <mfa_profile_name>
AWS Access Key ID [None]: ASIAxxxxxxxxxxxx
AWS Secret Access Key [None]: xxxxxxxxxxxxxxxxxxxx
Default region name [None]: us-east-1
Default output format [None]: json
```

- Then, open the `~/.aws/credentials` file and add the SessionToken line:

```ini
[mfa_profile_name]
aws_access_key_id = ASIAxxxxxxxxxxxx
aws_secret_access_key = xxxxxxxxxxxxxxxxxxxx
aws_session_token = xxxxxxxxxxxxxxxxxxxx
```

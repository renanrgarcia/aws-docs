# EC2 Instance Metadata

- AWS EC2 Instance Metadata (IMDS) is powerful but one of the least known features to developers
- It allows AWS EC2 instances to ”learn about themselves” without using an IAM Role for that purpose.
- The URL is http://169.254.169.254/latest/meta-data
- You can retrieve the IAM Role name from the metadata, but you CANNOT retrieve the IAM Policy.
- Metadata = Info about the EC2 instance
- Userdata = launch script of the EC2 instance

## IMDSv2 vs IMDSv1

- IMDSv1 is accessing http://169.254.169.254/latest/meta-data directly
- IMDSv2 is more secure and is done in two steps:
  1. Get Session Token (limited validity) – using headers & PUT
  - `TOKEN=$(curl -X PUT "http://169.254.169.254/latest/api/token" -H "X-aws-ec2-metadata-token-ttl-seconds: 21600")`
    - This token is valid for 6 hours (21600 seconds)
    - curl: command line tool to transfer data from or to a server
    - -X: specifies the request method to use, in this case, PUT
    - -H: adds a header to the request
  2. Use Session Token in IMDSv2 calls – using headers
  - `curl -H "X-aws-ec2-metadata-token: $TOKEN" http://169.254.169.254/latest/meta-data/`
    - This command retrieves the IAM Role name associated with the instance using the session token obtained in the previous step.
    - E.g., to get the instance ID: `curl -H "X-aws-ec2-metadata-token: $TOKEN" http://169.254.169.254/latest/meta-data/instance-id`
